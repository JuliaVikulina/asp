Прошивка оплаты на выезде с рампой унифицированная.

Введены настройки по всем элементам кассы на включение / отключение в работу.

Время сброса хопперов увеличино с 25 до 90 секунд.
Введена настройка разрешения работы хопперов [по умолчанию запрещено].
Введена настройка для сигнала "стоп" - срабатывает только на фотоэлемент безопасности [по умолчанию включено]:
 если включить этот параметр, реле "стоп" срабатывает только по фотоэлементу безопасности;
 если отключить этот параметр, реле "стоп" срабатывает по концевикам и по фотоэлементу безопасности.

Включены монетоприемник и хоппер.
Монетоприемник подключен на вход Coin Acceptor.
Хопперы подключены на входы Hopper.
Хопперы работают последовательно. Сначала Хоппер 1, потом Хоппер 2.
В Хоппер 1 надо прописывать максимальный номинал монет.
Сдача выдается последовательно, начиная с максимального номинала монет / купюр.
При инкассации происходит последовательный сброс хопперов.
Также в хопперы прописывается: Хоппер 1 - 10р/50монет и Хоппер 2 - 1р/50монет.
Для отключения рампы, нужно замкнуть вход S3 (датчик завершения проезда рампы).
Арбитраж проезда переделан на срабатывание непосредственно перед выездом клиента.
Счетчик свободных мест считает по петлям, независимо от алгоритма проезда.
Модифицирован набор управляющих кнопок.
Платежи по запросу сервера.
Безналичные платежи.
Убрано отображение номеров считаных карт доступа.
Работа ККМ дополнена возможностью автоматического закрытия смены в заданное время.
Добавлена очередь печати копий Z-отчетов (запрос с сервера, печать по кнопке).
Добавлена настройка контроля состояния карт доступа (на парковке / вне парковки).
 (настройка: "Общие"->"Отключить проверку состояния карты доступа").
Добавлена возможность широковещательной рассылки времени (раз в 3~5 минут)
 (настройка: "Время работы"->"Широковещательная рассылка времени").
Введена настройка срока действия билетов арендаторов
 (настройка: "Время работы"->"Срок действия билетов арендаторов", или непосредственно с web).
Билеты, напечатаные на терминале 15 (билеты для арендаторов) и укладывающиеся в срок действия - не оплачиваются.
Можно задать время работы парковки.
Исправлена ошибка в алгоритме работы шлагбаума (шлагбаум не прекращал работу по концевикам):
 при открытии работа прекращается по срабатыванию концевика открытого состояния;
 при закрытии работа прекращается по срабатыванию концевика закрытого состояния.
Добавлены настройки шлагбаума:
 Реле "стоп" нормально замкнутое (NC / NO)
  при установке галки реле "стоп" NC (то есть все свободное время замкнуто, а при команде "стоп" размыкается),
  при снятии галки реле "стоп" NO (то есть все свободное время разомкнуто, а при команде "стоп" замыкается).
 Закрытие шлагбаума без контроля фотоэлемента безопасности
  при установке галки закрытие шлагбаума будет выполняться после съезда авто с петли за шлагбаумом,
  при снятии галки закрытие шлагбаума будет выполняться при въезде авто на петлю за шлагбаумом и освобождении фотоэлемента безопасности шлагбаума.
Доработан тест.
Добавлен режим тестового проезда.
Убраны строки с рекламой.

Арбитраж работы стойки.
При совместной работе с соседней стойкой на один проезд необходима процедура арбитража проезда.
Когда нужно проехать, стойка выполняет арбитраж проезда следующим образом:
Если есть входящий запрос проезда (вход S4 на земле) - стойка дожидается освобождения проезда (пока вход S4 не освободиться).
Если нет входящего запроса арбитража (вход S4 свободен), формируется исходящий запрос арбитража (выход Light GND замыкается на землю).
Далее опять анализируется входящий запрос (вход S4) - в случае наличия входящего запроса (вход S4 на земле), то есть когда запрос
на проезд сформировался одновременно с двух стоек, исходящий запрос арбитража снимается (выход Light GND размыкается) и делается
пауза на случайный промежуток времени (до полутора секунд) и процедура арбитража повторяется заново.
Случайный интервал повторения арбитража дает возможность гарантировано выиграть арбитраж одной из стоек.

==================================================

Прошивка работает комплектом по UDP.

IP по умолчанию: 192.168.0.93

Кнопки:
B1 - отказ от платежа / запрос штрафа
B2 - вызов оператора
B3 - разблокировка
B3L - печать копий Z-отчетов
B4 - инкасация
B5 - x-report
B5L - z-report
B6 - оплата по банковской карте
B7 - внешний запрос выезда

Датчики:
S1 - датчик присутствия перед шлагбаумом
S2 - датчик присутствия после шлагбаума
S3 - датчик завершения проезда рампы
 Чтобы отключить рампу, нужно замкнуть вход завершения на землю и тогда сообщения рампы отправляться не будут.
S4 - арбитраж проезда
S5 - шлагбаум открыт
S6 - шлагбаум закрыт
S7 - фотоэлемент безопасности (НЗ)

Реле:
R1 - шлагбаум вверх
R2 - шлагбаум вниз
R3 - шлагбаум стоп
 Шлагбаум открывается и закрывается импульсами (длительность задается в настройках) до срабатывания концевиков или защиты.
 Если нет срабатывания концевиков, выполняется 3 попытки (с паузой 0.3 сек между импульсами).
 После завершения операции закрытия / открытия или при срабатывании защиты, выдается короткий (0.3 сек) импульс стоп.
 Полярность импульса стоп можно задать в настройках.
 Момент закрытия шлагбаума возможен либо по замыканию петли после шлагбаума и размыкании фотоэлемента безопасности,
 либо после размыкания петли после шлагбаума - определяется при настройке стойки.
R4 - Хоппер 2 (питание)
R5 - Хоппер 1 (питание)

Выход:
Light GND - запрос арбитража проезда

Оборудование:
COM1 - ККМ
COM2 - Диспенсер (LCDM2000)
COM3 - Купюроприемник (ID003)
COM4 - Считыватель штрихкодов
Coin Acceptor - Монетоприемник
Hopper - Хопперы 1 и 2
Card Reader - бесконтактный считыватель Wiegand
RS485 - новое табло
