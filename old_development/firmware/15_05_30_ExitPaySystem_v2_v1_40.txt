Прошивка оплаты на выезде с рампой унифицированная.
Для отключения рампы, нужно замкнуть вход S3 (датчик завершения проезда рампы).

Добавлена настройка арбитража для реверсивного проезда:
 в настройках шлагбаума пункт: "Арбитраж для реверсивного проезда"
  - при установке галки арбитраж срабатывает и проверяется сразу и в случае
    проигрыша арбитража стойка предлагает клиенту "Проезд занят, нужно отъехать..."
  - при снятии галки арбитраж срабатывает и проверяется только при готовности стойки
    к пропуску клинета: в случае если арбитраж занят, пишет клиенту "Ожидайте очереди проезда..."
Модифицирована работа шлагбаума на предмет скорости реакции на срабатывание концевиков и безопасности.
Добавлена проверка на срабатывание фотоэлемента безопасности, при его использовании для закрытия шлагбаума
 (в настройках галка "Закрытие шлагбаума без контроля фотоэлемента безопасности").
 Если эта галка сброшена и фотоэлемент работает (то есть меняет свое состояние), то закрытие шлагбаума
 будет выполняться после србабатывания петли за шлагбаумом и освобождения фотоэлемента безопасности.
 Если фотоэлемент неисправен и не меняет свое состояние, то закрытие шлагбаума будет выполняться только
 после срабатывания петли за шлагбаумом и ее освобождения, то есть как в варианте с установленой настройкой.
 Контроль срабатывания фотоэлемента безопасности производится каждый раз после открытия шлагбаума.
 То есть если шлагбаум для машины открыли, петля за шлагбаумом замкнулась, а фотоэлемент не срабатывал,
 то закрытие произойдет только по освобождению петли за шлагбаумом.
 Дополнительная степень безопасности, на случай если петля за шлагбаумом сработает раньше, чем фотоэлемент.

Время ожидания денег не более 15 сек.
Также ожидание денег сбрасывается при отъезде автомобиля с петли (если денег еще не внесено).
На экране вместо "Штраф: 500р." -> "За утрату: 500р."
На билете там где "Оплата штрафа." -> "Оплата утраты билета."
Вместо "Штраф: без билета." -> "Платеж: без билета."

Убрана ошибка с ложным сообщением "задержка на петле перед шлагбаумом стойки".
Добавлена задержка 0.5 сек. на срабатывание петлей шлагбаума, для устранения ложных срабатываний.
Оптимизирован и ускорен алгоритм выезда по билетам.
Оптимизирован и ускорен алгоритм выезда по картам.
Убрана ошибка с повторным получением сообщения.
Добавлена возможность приема не полных платежей по запросу извне.

Поправлен алгоритм обработки акцептированых билетов.

Установлена пауза 3 секунды на срабатывание концевиков шлагбаума.
Исправлено открытие и закрытие шлагбаума из программы установок.
Сделан независимый счетчик проездов по петлям.
Добавлены секторы для подсчета свободных мест.
Возвращено сообщение EDEV_CARD_EXIT.

Отключена блокировка и перезапуск купюроприемника по заклиниванию в акцепторе.
Отключен перезапуск купюроприемника по ошибке команды.
Добавлена версия тайваньского диспенсера "6I".
В случае не совпадения версий диспенсера, выдает ошибку с данными о несовпадающей версии.
Модифицирован код диспенсера.
В начало инкассации добавлены стекер биллакцептора и коробки диспенсера.
Сдача выдается последовательно, начиная с максимального номинала купюр.

Задержка на подготовку к работе ККМ - 10 сек.

Режим тестового проезда.
Платежи по запросу сервера.
Безналичные платежи.
Работа ККМ дополнена возможностью автоматического закрытия смены в заданное время.
Добавлена очередь печати копий Z-отчетов (запрос с сервера, печать по кнопке).

Добавлены настройки шлагбаума:
 Контроль и принудительное закрытие в закрытом состоянии шлагбаума [по умолчанию включена]:
  при установке галки включается функция принудительного закрытия шлагбаума (в случае несанкционированного открытия),
  при снятии галки функция принудительного открытия шлагбаума отключена.
 Реле "стоп" нормально замкнутое (NC / NO):
  при установке галки реле "стоп" NC (то есть все свободное время замкнуто, а при команде "стоп" размыкается),
  при снятии галки реле "стоп" NO (то есть все свободное время разомкнуто, а при команде "стоп" замыкается).
 Реле "стоп" срабатывает только на фотоэлемент безопасности:
  при установке галки реле "стоп" срабатывает только по фотоэлементу безопасности,
  при снятии галки реле "стоп" срабатывает каждый раз при необходимости остановки шлагбаума.
 Закрытие шлагбаума без контроля фотоэлемента безопасности:
  при установке галки закрытие шлагбаума будет выполняться после съезда авто с петли за шлагбаумом,
  при снятии галки закрытие шлагбаума будет выполняться при въезде авто на петлю за шлагбаумом и освобождении фотоэлемента безопасности шлагбаума.

Настройка контроля состояния карт доступа (на парковке / вне парковки):
 "Общие"->"Отключить проверку состояния карты доступа".
Широковещательная рассылка времени (раз в 3~5 минут):
 "Время работы"->"Широковещательная рассылка времени".

Билеты, напечатаные на терминале 15 (билеты для арендаторов) и укладывающиеся в срок действия - не оплачиваются.
Настройка срока действия билетов арендаторов:
 "Время работы"->"Срок действия билетов арендаторов", или непосредственно с web.

Арбитраж работы стойки.
При совместной работе с соседней стойкой на один проезд необходима процедура арбитража проезда.
Когда нужно проехать, стойка выполняет арбитраж проезда следующим образом:
Если есть входящий запрос проезда (вход S4 на земле) - стойка дожидается освобождения проезда (пока вход S4 не освободиться).
Если нет входящего запроса арбитража (вход S4 свободен), формируется исходящий запрос арбитража (выход Light GND замыкается на землю).
Далее опять анализируется входящий запрос (вход S4) - в случае наличия входящего запроса (вход S4 на земле), то есть когда запрос
на проезд сформировался одновременно с двух стоек, исходящий запрос арбитража снимается (выход Light GND размыкается) и делается
пауза на случайный промежуток времени (до полутора секунд) и процедура арбитража повторяется заново.
Случайный интервал повторения арбитража дает возможность гарантировано выиграть арбитраж одной из стоек.

==================================================

Прошивка работает комплектом по UDP.

IP по умолчанию: 192.168.0.93

Кнопки:
B1 - отказ от платежа / запрос штрафа
B2 - вызов оператора
B3 - разблокировка
B3L - печать копий Z-отчетов
B4 - инкасация
B5 - x-report
B5L - z-report
B6 - оплата по банковской карте
B7 - внешний запрос выезда

Датчики:
S1 - датчик присутствия перед шлагбаумом
S2 - датчик присутствия после шлагбаума
S3 - датчик завершения проезда рампы
 Чтобы отключить рампу, нужно замкнуть вход завершения на землю и тогда сообщения рампы отправляться не будут.
S4 - арбитраж проезда
S5 - шлагбаум открыт
S6 - шлагбаум закрыт
S7 - фотоэлемент безопасности (НЗ)

Реле:
R1 - шлагбаум вверх
R2 - шлагбаум вниз
R3 - шлагбаум стоп
 Шлагбаум открывается и закрывается импульсами (длительность задается в настройках) до срабатывания концевиков или защиты.
 Если нет срабатывания концевиков, выполняется 3 попытки (с паузой 0.3 сек между импульсами).
 После завершения операции закрытия / открытия или при срабатывании защиты, выдается короткий (0.3 сек) импульс стоп.
 Полярность импульса стоп можно задать в настройках.
 Момент закрытия шлагбаума возможен либо по замыканию петли после шлагбаума и размыкании фотоэлемента безопасности,
 либо после размыкания петли после шлагбаума - определяется при настройке стойки.
R4 - красный светофор
R5 - зеленый светофор

Выход:
Light GND - запрос арбитража проезда

Оборудование:
COM1 - ККМ
COM2 - Диспенсер (LCDM2000)
COM3 - Купюроприемник (ID003)
COM4 - Считыватель штрихкодов
Card Reader - бесконтактный считыватель Wiegand
RS485 - новое табло
