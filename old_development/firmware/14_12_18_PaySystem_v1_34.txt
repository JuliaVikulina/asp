Прошивка кассы.

Для коректной работы стойка кассы должна иметь номер от 8.

Внесены все необходимые изменения, для приведения в соответствие с терминалом оплаты на выезде.
Смотреть ExitPaySystem от 18.12.2014

Внесены ряд изменений в систему запроса платежей и работу ККМ,
позволяющих принимать не полную оплату запрошенного платежа.
Введен патч на подтверждение платежа с сервера - даже если приходит запрет - все равно принимаем.


Отключена блокировка и перезапуск купюроприемника по заклиниванию в акцепторе.
Отключен перезапуск купюроприемника по ошибке команды.

Убрано отображение номеров считаных карт доступа.
Добавлено сообщение об ассоциировании исходного и напечатанного билетов (после оплаты).

Подключен терминал оплаты по картам (включается при нажатии кнопки безналичной оплаты).
Модифицирована команда ККМ на печать копии Z-отчета.
В ККМ-фин-репорт добавлены стекер биллакцептора и коробки диспенсера.

В версии базы 2.12 модифицирован интерфейс бухгалтера.
Работа с отдельными стойками:
Добавилась информация о номере последней закрытой смены: "Номер последней закрытой смены"
И возможность запроса копий z-отчетов (итогов смены).
Нужные номера смен можно ввести через запятую. Ниже появится список отчетов, отправленных на стойку в очередь печати.
Очистить список можно кнопкой "очистить". Печать отчетов осуществится после нажатия кнопки печати на стойке.
По мере печати, отчеты будут удаляться из очереди и из списка на сервере.
Работа со всеми кассами:
Добавилась закладка "Кассы".
В этой закладке можно узнать состояние касс и назначить режим автоматического закрытия смен без печати Z-отчетов.
Режим автоматического закрытия смен можно задать как для всех касс, так и индивидуально для каждой кассы.

Номер последней закрытой смены запрашивается командой "Информация о свободных ресурсах и статусе".
При этом по умолчанию печатается документ.
Для отключения печати документа нужно настроить ККМ - программа frs:
 меню "Установки"->"Установка параметров" установить галку "Не печатать чек ресурсы".
Также обратить внимание на настройку "Начало смены" - если установлено "Любым документом",
то запрос номера последней закрытой смены будет автоматически открывать новую смену.
Если такое открытие смены не нужно - установить галку "Первым фискальным документом"
и смена будет открываться первым чеком.

Дополняем работу ККМ возможностью автоматического закрытия смены в заданное время.
При каждом закрытии смены ККМ запрашивает номер последней смены и сообщает его серверу.
Делаем очередь печати копий Z-отчетов (запрос с сервера, печать по кнопке).
Модифицируем код обработки ошибок ККМ - меньше ситуаций с блокировкой кассы.
Время на стойке можно выставить из настроек, нажав кнопку "Синхронизовать время" в закладке "Время работы".
Добавлена возможность широковещательной рассылки времени (раз в 3~5 минут)
 (настройка: "Время работы"->"Широковещательная рассылка времени").
Если на стойке включена широковещательная рассылка времени, на web выдается сообщение с текущим временем стойки.
Добавлена настройка контроля состояния карт доступа (на парковке / вне парковки).
 (настройка: "Общие"->"Отключить проверку состояния карты доступа").
Введена настройка срока действия билетов арендаторов
 (настройка: "Время работы"->"Срок действия билетов арендаторов", или непосредственно с web).
Билеты, напечатаные на терминале 15 (билеты для арендаторов) и укладывающиеся в срок действия - не оплачиваются.
Вводим время работы парковки, вне этого времени клиенты не обслуживаются.
Вводим запрос платежа и печать чека с сервера.
Из блока печати убраны строки с рекламой и названием фирмы.
В заставке пишем "(с)2014 АвтоПарк".
Добавлены карты доступа (1000шт) в локальную память.

==================================================

IP по умолчанию: 192.168.0.93

Кнопки:
B1 - сброс (отказ от платежа)
B2 - вызов оператора
B3 - разблокировка
B4 - инкасация
B5 - Z-Report
B6 - X-Report
B7 - запрос оплаты штрафа

Датчики:
S1 - печать копий Z-отчетов
S6 - оплата наличными
S7 - оплата по банковской карте

Реле:
R4 - Хоппер 2 (питание)
R5 - Хоппер 1 (питание)

Оборудование:
USB - Платежный терминал UPT7000 (протокол Сбербанка)
COM1 - ККМ
COM2 - Диспенсер (LCDM2000)
COM3 - Купюроприемник (ID003)
COM4 - Считыватель штрихкодов
Card Reader - бесконтактный считыватель Wiegand
RS485 - старое табло
Звук.

==================================================
