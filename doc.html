<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Der Shlagbaumverk</title>
<!-- 2015-11-24 Вт. 21:29 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="rigidus" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<!-- -*- fill-column: 87 -*- -->
<!-- org-toggle-inline-images -->

<script type="text/javascript" src="http://orgmode.org/org-info.js">
/**
 *
 * @source: http://orgmode.org/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://orgmode.org/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://orgmode.org/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "0");
org_html_manager.set("VIEW", "overview");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Der Shlagbaumverk</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Цель</a></li>
<li><a href="#sec-2">2. Описание функционирования</a>
<ul>
<li><a href="#sec-2-1">2.1. Общий принцип работы</a></li>
<li><a href="#sec-2-2">2.2. Состояния стойки при проезде</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1. Стойка в режиме ожидания (<code>standby</code>)</a></li>
<li><a href="#sec-2-2-2">2.2.2. Подъезд машины к стойке (<code>finding</code>)</a></li>
<li><a href="#sec-2-2-3">2.2.3. Стойка в диалоговом режиме (<code>dialog</code>)</a></li>
<li><a href="#sec-2-2-4">2.2.4. Инициация процедуры въезда (<code>init</code>)</a></li>
<li><a href="#sec-2-2-5">2.2.5. Процедура проезда (<code>goon</code>)</a></li>
<li><a href="#sec-2-2-6">2.2.6. Процедура завершения въезда (<code>fin</code>)</a></li>
</ul>
</li>
<li><a href="#sec-2-3">2.3. Примеры алгоритмов</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. Алгоритм простого въезда по чеку</a></li>
<li><a href="#sec-2-3-2">2.3.2. Рампа</a></li>
<li><a href="#sec-2-3-3">2.3.3. Проезд по карте СКУД</a></li>
<li><a href="#sec-2-3-4">2.3.4. <span class="todo nilWAIT">WAIT</span> Фотофиксация въезда</a></li>
<li><a href="#sec-2-3-5">2.3.5. <span class="todo nilWAIT">WAIT</span> Звуковое сопровождение</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. Состояния стойки при выезде</a>
<ul>
<li><a href="#sec-2-4-1">2.4.1. Стойка в режиме ожидания (<code>standby</code>)</a></li>
<li><a href="#sec-2-4-2">2.4.2. Подъезд машины к стойке (<code>finding</code>)</a></li>
<li><a href="#sec-2-4-3">2.4.3. Стойка в диалоговом режиме (<code>dialog</code>)</a></li>
<li><a href="#sec-2-4-4">2.4.4. <span class="todo nilWAIT">WAIT</span> Процедура оплаты (<code>payment</code>)</a></li>
<li><a href="#sec-2-4-5">2.4.5. Инициация процедуры выезда (<code>init</code>)</a></li>
<li><a href="#sec-2-4-6">2.4.6. Процедура проезда (<code>goon</code>)</a></li>
<li><a href="#sec-2-4-7">2.4.7. Процедура завершения въезда (<code>fin</code>)</a></li>
</ul>
</li>
<li><a href="#sec-2-5">2.5. Примеры алгоритмов</a>
<ul>
<li><a href="#sec-2-5-1">2.5.1. Алгоритм простого выезда по чеку</a></li>
<li><a href="#sec-2-5-2">2.5.2. Проезд по карте СКУД</a></li>
<li><a href="#sec-2-5-3">2.5.3. <span class="todo nilWAIT">WAIT</span> Фотофиксация въезда</a></li>
<li><a href="#sec-2-5-4">2.5.4. Звуковое сопровождение</a></li>
<li><a href="#sec-2-5-5">2.5.5. <span class="todo nilTODO">TODO</span> Работа с автоматической кассой</a></li>
<li><a href="#sec-2-5-6">2.5.6. <span class="todo nilTODO">TODO</span> Процедура оплаты</a></li>
<li><a href="#sec-2-5-7">2.5.7. <span class="todo nilTODO">TODO</span> Процедура инкассации</a></li>
<li><a href="#sec-2-5-8">2.5.8. <span class="todo nilTODO">TODO</span> Процедура закрытия смены</a></li>
<li><a href="#sec-2-5-9">2.5.9. <span class="todo nilTODO">TODO</span> Работа контроллера при обрыве связи с сервером</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. Особенности секторальности и тарификации</a></li>
<li><a href="#sec-4">4. Протоколы обмена данными</a></li>
<li><a href="#sec-5">5. Контроллер (требования)</a>
<ul>
<li><a href="#sec-5-1">5.1. Гибкость системы</a></li>
<li><a href="#sec-5-2">5.2. Web-интерфейс для настройки контроллера</a></li>
<li><a href="#sec-5-3">5.3. Обработка аудио</a></li>
<li><a href="#sec-5-4">5.4. Работа с дисплеями</a></li>
<li><a href="#sec-5-5">5.5. Периферийные устройства контроллера и протоколы связи</a></li>
<li><a href="#sec-5-6">5.6. Выводы на аудио оборудование</a></li>
<li><a href="#sec-5-7">5.7. Выводы на сухой контакт реле</a></li>
<li><a href="#sec-5-8">5.8. Выводы на сенсоры и кнопки</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Серверная часть</a></li>
<li><a href="#sec-7">7. Основной функционал сервера:</a></li>
<li><a href="#sec-8">8. Дополнительные модули сервера</a>
<ul>
<li><a href="#sec-8-1">8.1. Модуль <code>платной парковки</code></a></li>
<li><a href="#sec-8-2">8.2. Модуль <code>СКУД</code></a></li>
<li><a href="#sec-8-3">8.3. Модуль для <code>работы с абонементами</code></a></li>
<li><a href="#sec-8-4">8.4. Модуль для <code>работы по дебетовым картам</code></a></li>
<li><a href="#sec-8-5">8.5. Модуль <code>акцептирования</code></a></li>
<li><a href="#sec-8-6">8.6. Модуль <code>арендаторов</code></a></li>
<li><a href="#sec-8-7">8.7. Модуль <code>кассира</code></a></li>
<li><a href="#sec-8-8">8.8. Модуль <code>бухгалтера</code></a></li>
<li><a href="#sec-8-9">8.9. Модуль <code>фотофиксации</code></a></li>
<li><a href="#sec-8-10">8.10. Модуль <code>распознания номеров</code></a></li>
<li><a href="#sec-8-11">8.11. Модуль <code>дуплексной IP связи</code></a></li>
</ul>
</li>
<li><a href="#sec-9">9. План работ</a>
<ul>
<li><a href="#sec-9-1">9.1. <span class="todo nilSTART">START</span> Составление исполняемой спецификации, внесение описаний работы и кейсов</a>
<ul>
<li><a href="#sec-9-1-1">9.1.1. <span class="todo nilSTART">START</span> Описать <code>happy-cases</code></a></li>
<li><a href="#sec-9-1-2">9.1.2. <span class="todo nilTODO">TODO</span> Описать полный цикл работы системы с обработкой ошибок</a></li>
<li><a href="#sec-9-1-3">9.1.3. <span class="todo nilTODO">TODO</span> Составить список событий в системе и конечный автомат</a></li>
</ul>
</li>
<li><a href="#sec-9-2">9.2. <span class="todo nilTODO">TODO</span> Выделение состояний системы</a></li>
<li><a href="#sec-9-3">9.3. Описание конечно-автоматной работы системы и ее ручная верификация</a></li>
<li><a href="#sec-9-4">9.4. Декларативное описание конечных автоматов</a></li>
<li><a href="#sec-9-5">9.5. Написание генератора кода модели системы</a></li>
<li><a href="#sec-9-6">9.6. Верификация работы системы на модели</a></li>
<li><a href="#sec-9-7">9.7. Расширение модели рабочим кодом</a></li>
<li><a href="#sec-9-8">9.8. Макетирование прототипа</a></li>
<li><a href="#sec-9-9">9.9. Проверка элементов системы на макете прототипа</a></li>
<li><a href="#sec-9-10">9.10. Тестирование рабочего кода на прототипе устройства</a></li>
<li><a href="#sec-9-11">9.11. Отладка и интеграционное тестирование</a></li>
</ul>
</li>
</ul>
</div>
</div>
<link rel="stylesheet" type="text/css" href="/css/css.css" />

<p>
Спецификация на разработку аппаратно-программного комплекса управления автоматизации
парковки
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Цель</h2>
<div class="outline-text-2" id="text-1">
<p>
Создаем решение для оснащения платных парковок.
</p>

<p>
Разрабатываемые компоненты:
</p>

<p>
<code>Контроллер</code> - одноплатный микрокомпьютер на базе микроконтроллера архитектуры ARM
Cortex-А7 или ARM Cortex-А9.
</p>

<p>
Допускается:
</p>
<ul class="org-ul">
<li>использование готовых решений одноплатных микрокомпьютеров
</li>
<li>варианты микропроцессоров с аналогичными характеристиками
</li>
</ul>

<p>
Возможно рассмотрение вариантов микропроцессоров отечественной разработки.
</p>

<p>
<code>Плата расширения</code>, обеспечивающая функционал управления оборудованием автоматической
парковки.
</p>

<p>
<code>Сервисная программа контроллера</code> - прошивка для микроконтроллера, представляющая
собой встраиваемую операционную систему на базе ядра Linux и развёрнутое на ней
сервисное программное обеспечение.
</p>

<p>
Функции:
</p>
<ul class="org-ul">
<li>Подключение оборудования, используемого с платой расширения на лету (путем закачки
и/или выбора динамических библиотек через интернет) без перезагрузки.
</li>
<li>Управление всеми вводами/выводами платы расширения
Вводы выводы платы описаны в разделах:
<ul class="org-ul">
<li><a href="#sec-5-5">Периферийные устройства контроллера и протоколы связи</a>
</li>
<li><a href="#sec-5-6">Выводы на аудио оборудование</a>
</li>
<li><a href="#sec-5-7">Выводы на сухой контакт реле</a>
</li>
</ul>
</li>
<li>Технологическая настройка работы всего периферийного оборудования (перед
использованием) подключенного к плате расширения из браузера по IP-адресу
контроллера. Описание как это будет - в разделе:
<ul class="org-ul">
<li><a href="#sec-5-2">Web-интерфейс для настройки контроллера</a>
</li>
</ul>
</li>
<li>Гибкая настройка алгоритмов и последовательности работы
оборудования, подключенного к плате расширения (на ходу)
</li>
<li>Выполнение функций абонентского устройства и взаимодействия с серверами IP
связи/телефонии. Каждый контроллер должен выглядеть в локальной сети как
SIP-устройство, чтобы оператор мог общаться с клиентом, находящимся у стойки.
</li>
<li>Запрашивать и обрабатывать/хранить данные с IP камер. Осуществлять фотофиксацию по
определенным событиям (нажатие кнопки, подъезд машины) и фотосьемку по временном
интервале.
</li>
<li>Распознавание номеров на сделанных фотографиях.
</li>
<li>Осуществлять голосовое сопровождение пользователя на всех этапах работы с
оборудованием - проигрывание аудиозаписей по определенным событиям, в
т.ч. проигрывание записей с SD-карты.
</li>
<li>Вести логгирование работы системы на сервер и SD-карту.
</li>
<li>Иметь защиту от несанкционированного подключения (логин/пароль) и выполнять
шифрование трафика при общении с сервером.
</li>
<li>Обладать максимальным возможным объемом автономности (независимости от серверного
ПО)
</li>
</ul>

<p>
При обрыве связи контроллер в качестве источника данных использует не сервер а SD-карту.
</p>


<p>
<code>Центральный сервер</code> - персональный компьютер, на котором развёрнута программа
управления парковкой и хранится база данных со всеми настройками системы и
пользователей, а также история событий.
</p>

<p>
<code>Серверное ПО</code> - это программа управления парковкой, через которую осуществляется
настройка всех основных модулей системы и управление парковочной системой. Серверное
ПО имеет ядро (сервер приложений?, бэкенд?), базу данных под управлением выбранной
СУБД, модульный интерфейс (фронтенд) и гибкую систему лицензирования и защиты
программных средств.
</p>

<p>
<code>Клиентский интерфейс</code> - интерфейс модуля сервера, доступный через браузер по IP
адресу и заданному порту сервера, к которому получает доступ конечный пользователь
системы.
</p>

<p>
<code>Клиентская программа</code> - отдельно устанавливаемое на ПК (рабочую станцию) программное
обеспечение, настраиваемое на взаимодействие с сервером, которое использует конечный
пользователь системы.
</p>

<p>
[TODO] - лучше пусть это будет броузер - дешевле выйдет в разработке и поддержке
[Re] - ты уверен, что пробрасывать подключение торгового оборудования (сканер
штрих-кодов и ККМ) в браузер - это просто? Ну и в перспективе нужна будет прога,
которая сможет работать автономно с ограниченным функционалом.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Описание функционирования</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Общий принцип работы</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Клиент на автомобиле вьезжает в зону действия <code>датчика присутствия</code>, нажимает на
кнопку и получает <code>билет</code> со <code>штрихкодом</code>.
</p>

<p>
<code>Датчик присутствия</code> - петля индуктивности, фотоэлемент и/или датчик магнитного поля.
</p>

<p>
В будущем планируется адаптировать систему также под карты Mifare.
</p>

<p>
В штрикоде зашифровано:
</p>
<ul class="org-ul">
<li>терминал вьезда
</li>
<li>время вьезда
</li>
<li>массогабаритные характеристики ТС клиента (например, в таком формате: 0 -
легковой, 1 - средний, 2 - грузовик)
</li>
</ul>

<p>
<code>Штрихкод</code> должен быть зашифрован, чтобы избежать попыток подстановки данных со
стороны клиента
</p>

<p>
В <code>билете</code> также открытым текстом напечатано:
</p>
<ul class="org-ul">
<li>текущее время вьезда
</li>
<li>номер терминала
</li>
<li>номер сектора парковки / тарифной зоны
</li>
<li>уникальный код билета (буквенно-цифровой)
</li>
</ul>

<p>
После того как пользователь возьмет билет, открывается шлакбаум. Взятие билета
пользователем мы ослеживаем через протокол общения с принтером, который описан в
документации. Документация [TODO:pyub] будет лежать тут: <a href="file://devices">devices</a>
</p>

<p>
во время проезда машины под стрелой шлагбаума его закрытие невозможно - наличие
автомобиля фиксируется фотоэлементом на линии стрелы и датчиком за ней. Это сухой
контакт, описано в разделе <a href="#sec-5-8">Выводы на сенсоры и кнопки</a>. По факту проезда шлагбаум
закрывается. После въезда начинается допустимое бесплатное время нахождения на
парковке.
</p>

<p>
Также имеется возможность попасть на парковку по бесконтактным картам доступа
Em-Marine, которые заранее программируются и выдаются клиентам (система СКУД для
постоянных клиентов и владельцев). Со считывателем СКД (Em-MarineIron Logic Matrix V
/ Matrix II EH) мы общаемся по протоколу "Wiegand 26", документация [TODO:pyub]
</p>

<p>
Далее посетитель парковки должен произвести оплату парковочного времени. Это воможно
сделать тремя осовными способами:
</p>
<ul class="org-ul">
<li>оплатить на автоматической кассе
</li>
<li>оплатить на ручной кассе (ПК на котором оператор в программе принимает оплату)
</li>
<li>акцептировать билет у одного из арендаторов (сбросить время или перевести его на
счёт арендатора)
</li>
</ul>
<p>
В рамках пилотного проекта мы делаем только оплату на ручной кассе, где кассир
сообщает системе о проведенной оплате через броузер.
</p>

<p>
В любом случае информация с билета считывается с помощью сканера штрих кодов (для
карт Mifare будет использоваться считыватель-программатор), либо на ПК вводом
буквенно-цифрового кода с билета. При считывании посетителю сообщается сумма оплаты,
которую он должен внести. По факту приёма оплаты печатается фискальный чек, он же
выездной билет, а въездной билет аннулируется. Кроме оплаты билет может быть
акцептирован (обнулён) арендатором с помощью специальной карты или на ПК (об этом
подробнее в описании фнкционала акцептирования).
</p>

<p>
Стоимость парковки может варьироваться в зависимости от времени пребывания на ней,
тарифной сетки (разные тарифы в разное время суток и дни недели) и тарифных зон (на
одной парковке может быть несколько секторов, в каждом из которых парковка стоит по
разному, между ними стоят проездные стойки).
</p>

<p>
После оплаты устанавливается допустимое время нахождения на парковке до выезда. Если
посетитель находится больше времени, чем было установлено, ему необходимо снова
оплачивать время.
</p>

<p>
[TODO:pyub] - надо подробнее рассмотреть этот кейс, со всеми возможными сбоями и
вариантами их обработки в соответствующем разделе.
</p>

<p>
На выезде посетитель парковки при попадании автомобиля в зону действия датчика
присутствия подносит свой билет к сканеру штрих кодов и, если допустимое время
нахождения на парковке не истекло, ему позволяется покинуть парковку (в случае
Mifare карт карта вставляется в приемник и он её заглатывает). Также имеется
возможность покинуть парковку по бесконтактным Em-Marine картам доступа CКУД.
</p>

<p>
[Discuss:Rigidus] - Сразу видно вариант, как обмануть систему - заехать на парковку штатно, а
когда надо выезжать - подьехать к вьезду на другой машине, взять билет и не
вьезжать. Попросить можно кого-угодно из автомобилистов рядом. Потом по этому билету
спокойно выезжаешь, пользуясь "бесплатным временем". Как планируется
противодействовать такому сценарию?
[Discuss::pyub] Это описано в алгоритме ниже. Если въезд не завершён до конца, то полученный
билет аннулируется через время t. Но в целом бороться с этим надо в первую очередь
административными методами. По факту такие ситуации крайне редко бывают. И у тех
жмотов, у кого нет камер и парковщиков.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Состояния стойки при проезде</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Независимо от используемого комплекта периферийного оборудования контроллера при
въезде может находится в следующих состояниях:
</p>

<p>
[TODO:pyub] - для всех состояний необходимо описать условия входа и выхода в состояние,
чтобы сгенерировать код диспетчера машины состояний.
</p>
</div>

<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Стойка в режиме ожидания (<code>standby</code>)</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Режим работы в котором датчик стойки не видит автомобиля и не идёт никакой другой
процесс. В нём стойка реагирует на действия пользователя только сервисными
сообщениями, выводя на дисплей либо сообщение о том, что нет автомобиля, либо
сервисное сообщение о статусе карты/чека. Вся периферия неактивна.
</p>

<p>
Различие в алгоритмах режима ожидания главным образом заключается в том, что к стойкам
может быть подключен разный набор датчиков, соответственно условие перехода в
следующее состояние зависит от конкретного набора.
</p>

<p>
Также в зависимости от настроек пользователя по разному работает взаимодействие с
пользователем: нет машины - пошел нафиг, продажа карточек и.т.п. [TODO:pyub] - создать
отдельные разделы описывающие эти варианты и дать на них ссылки здесь.
</p>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> Подъезд машины к стойке (<code>finding</code>)</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Процесс определения датчиком (петлёй индуктивности, фотоэлементом, датчиком
магнитного поля) наличия машины у стойки, возможно массы и/или габаритов
автотранспортного средства, а также контроля подъезда к стойке (например при
проезде по рампе или через шлюз из двух шлагбаумов).
</p>

<p>
Различие в алгоритмах режима - рампа, определялка высоты по замкнутым контактам
весов, по магнитному полю - то же - [TODO:pyub]
</p>
</div>
</div>

<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> Стойка в диалоговом режиме (<code>dialog</code>)</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
После срабатывания датчика присутствия стойка начинает диалог с посетителем, выводя
на дисплей сообщения о необходимости совершения действий, ошибок и т.п. В этом
режиме посетитель может нажать кнопку и получить от периферийного устройства
въездной документ (чек или карту) или приложить к считывателю карту СКУД. На этом
этапе осуществляется арбитраж в случае использования реверсивного проезда (один
шлагбаум на две стойки с разных сторон) или использования двух стоек для левого и
правого руля.
</p>

<p>
Различия [TODO:pyub] по принтеру, диспенсеру карт, сканеру штрихкодов.
</p>
</div>
</div>

<div id="outline-container-sec-2-2-4" class="outline-4">
<h4 id="sec-2-2-4"><span class="section-number-4">2.2.4</span> Инициация процедуры въезда (<code>init</code>)</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
После того, как посетителю разрешён въезд (из презентера устройства забран чек или
карта, или успешно проверен статус карты СКУД) контроллер инициирует процесс
открытия шлагбаума, замыкая соответсвующие реле и принимая сигналы с концевиков
шлагбаума (или давая выставленный в миллисекундах импульс, если концевиков нет).
</p>

<p>
Различия [TODO:pyub] по выходныи данным устройств, приводящим к выходу из состояния.
</p>
</div>
</div>

<div id="outline-container-sec-2-2-5" class="outline-4">
<h4 id="sec-2-2-5"><span class="section-number-4">2.2.5</span> Процедура проезда (<code>goon</code>)</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
После открытия шлагбаума контроллер контролирует проезд машины под стрелой,
принимая сообщения с датчика безопасности (фотоэлемент на линии стрелы) и датчика
завершения проезда (петля индуктивности за стрелой, фотоэлмент, датчик МП). В эту
же процедуру может входит контроль проезда по рампе или через шлюз, находящийся за
стойкой.
</p>

<p>
Различия [TODO:pyub] по рампе/шлюзу/реверсивному движению и аналогично предыдущему.
</p>
</div>
</div>

<div id="outline-container-sec-2-2-6" class="outline-4">
<h4 id="sec-2-2-6"><span class="section-number-4">2.2.6</span> Процедура завершения въезда (<code>fin</code>)</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
Процесс закрытия шлагбаума после проезда машины, отправки итоговых данных о
совершённом проезде на сервер и возвращения стойки в режим ожидания.
</p>

<p>
Различия [TODO:pyub] по отправляемым на сервер данным от переферии и настроек
тарифных зон.
</p>

<p>
[TODO:pyub] Особенно важный ГЛОБАЛЬНЫЙ кейс - общение стоек между собой в условиях
отсутствия связи - надеюсь мы не будем поднимать это пока не сдадим пилотный проект.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Примеры алгоритмов</h3>
<div class="outline-text-3" id="text-2-3">
</div><div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> Алгоритм простого въезда по чеку</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Простейший алгоритм для парковки, работающей по чекам с стандартным комплектом
датчиков и контроля проезда. В алгоритм введены светофор и счётчик мест
(светодиодное табло).
</p>

<p>
[TODO:pyub] - Переформатировать, избавиться от нумерации, вместо нее поставить
точки расширения ссылками.
</p>
</div>

<ol class="org-ol"><li><a id="sec-2-3-1-1"></a><code>Подъезд машины</code><br  /><ol class="org-ol"><li><a id="sec-2-3-1-1-1"></a>Машина подъезжает к стойке, с сенсорного устройства у стойки (контроллер петли индуктивность, фотоэлемент и т.п.) на контроллер отправляется сигнал.<br  /></li>
<li><a id="sec-2-3-1-1-2"></a>Контроллер получает сигнал о том, что у стойки находится машина и из режима ожидания переховодит стойку в активный режим.<br  /></li>
<li><a id="sec-2-3-1-1-3"></a>Замыкается реле, отвечающее за красный сигнал на светофоре.<br  /></li>
<li><a id="sec-2-3-1-1-4"></a>На сервер отправляет инфосообщение "Машина у стойки въезда".<br  /></li></ol>
</li>

<li><a id="sec-2-3-1-2"></a><code>Активный режим (диалог спользователем)</code><br  /><ol class="org-ol"><li><a id="sec-2-3-1-2-1"></a>Контроллер переводит периферийные устройства в режим обслуживания клиента:<br  /><div class="outline-text-6" id="text-2-3-1-2-1">
<ul class="org-ul">
<li>включается подсветка кнопки печати билета;
</li>
<li>на дисплей выдаётся информационное сообщение "Нажмите кнопку и получите билет".
</li>
</ul>
</div>
</li>
<li><a id="sec-2-3-1-2-2"></a>Клиент нажимает кнопку печати билета, сигнал с кнопки приходит на сенсорный вход контроллера.<br  /></li>
<li><a id="sec-2-3-1-2-3"></a>Контроллер получает сигнал на печать билета и отправляет на принтер команду "напечатать билет с необходимой информацией" (штрих-код, зашифрованный в соответствии с предустановленным кодом; текущее время; номер терминала въезда; номер тарифной зоны; предустановленную доп. информацию).<br  /></li>
<li><a id="sec-2-3-1-2-4"></a>Принтер печатает билет, его сенсоры контролируют состояние печати (возможно замятие, окончание бумаги и т.п.). Когда печать завершена билет находится в презентере.<br  /></li>
<li><a id="sec-2-3-1-2-5"></a>Контроллер блокирет периферию, защищая систему от повторного получения въездного документа. На дисплей выводится сообщение "Забирите билет".<br  /></li>
<li><a id="sec-2-3-1-2-6"></a>Если билет не забран из презентера клиентом более t секунд - принтер сообщает об этом контроллеру, контроллер отбивает ошибку на сервер и анулирует билет.<br  /></li>
<li><a id="sec-2-3-1-2-7"></a>Еслли клиент забирает билет из презентера, принтер сообщает об этом контроллеру.<br  /></li>
<li><a id="sec-2-3-1-2-8"></a>Контроллер сообщает на сервер "Напечатан билет №".<br  /></li></ol>
</li>

<li><a id="sec-2-3-1-3"></a><code>Инициация проезда</code><br  /><ol class="org-ol"><li><a id="sec-2-3-1-3-1"></a>Контроллер получает сигнал от принтера о том, что билет забран из презентера, что является действием, инициирующим процедуру проезда.<br  /></li>
<li><a id="sec-2-3-1-3-2"></a>Контроллер  замыкает реле, отвечающее за открытие шлагбаума  за стойкой (реле замкнуто либо до прихода на сенсорный ввод сигнала "открыт", либо по длине импульса из настроек контроллера)<br  /></li>
<li><a id="sec-2-3-1-3-3"></a>Контроллер сообщает серверу "Открытие шлагбаума стойки №"<br  /></li></ol>
</li>

<li><a id="sec-2-3-1-4"></a><code>Процедура проезда</code><br  /><ol class="org-ol"><li><a id="sec-2-3-1-4-1"></a>Когда стрела шлагбаума открывается, в шлагбауме срабатывает концевик открытия - сигнал с него приходит на сенсор "открытие" контроллера<br  /></li>
<li><a id="sec-2-3-1-4-2"></a>Контроллер фиксирует факт того, что шлагбаум в открытом положении совершаются следующие действия:<br  /><div class="outline-text-6" id="text-2-3-1-4-2">
<ul class="org-ul">
<li>замыкает реле, отвечающее за зелёный свет на светофоре;
</li>
<li>размыкает реле, отвечающее за красный свет на светофоре;
</li>
<li>сообщает серверу "Шлагбаум стойки № открыт"
</li>
</ul>
</div>
</li>
<li><a id="sec-2-3-1-4-3"></a>Когда машина пересекает линию фотоэлемента безопасности (стрелы шлагбаума) с ф/э приходит сигнал на сэнсор.<br  /></li>
<li><a id="sec-2-3-1-4-4"></a>Контроллер, имея сигнал с ф/э безопасности на сенсор, переходит в режим "стоп" - пока сенсор не освобождён стрела шлагбаума не должна закрыться.<br  /></li>
<li><a id="sec-2-3-1-4-5"></a>Машина проезжает шлагбаум,  с сенсорного устройства за его стрелой (контроллер петли индуктивности, фотоэлемент, датчик МП) на контроллер отправляется сигнал.<br  /></li>
<li><a id="sec-2-3-1-4-6"></a>Контроллер получает подтверждение завершения проезда и начинает соответсвующую процедуру.<br  /></li></ol>
</li>

<li><a id="sec-2-3-1-5"></a><code>Процедура завершения проезда</code><br  /><ol class="org-ol"><li><a id="sec-2-3-1-5-1"></a>Получив подтверждение окончания проезда - нет сигнала на сенсор безопасности проезда и на сенсор петли за шлагбаумом - контроллер инициирует следующеи действия:<br  /><div class="outline-text-6" id="text-2-3-1-5-1">
<ul class="org-ul">
<li>размыкает реле, отвечающее за зелёный свет на светофоре;
</li>
<li>замыкает реле, отвечающее за красный свет на светофоре;
</li>
<li>замыкает реле, отвечающее за закрытие шлагбаума за стойкой (реле замкнуто либо до прихода на сенсорный ввод сигнала "закрыт" с концевика, либо по длине импульса из настроек контроллера)
</li>
<li>сообщает серверу "проезд по билету № успешно завершен", а также об изменении количества мест в секторе и данные по билету
</li>
<li>отправляет на табло счётчика мест по RS-485 сообщение "-1 место"
</li>
</ul>
</div>
</li>
<li><a id="sec-2-3-1-5-2"></a>Получив сигнал с концевика закрытия на сенсор контроллер:<br  /><div class="outline-text-6" id="text-2-3-1-5-2">
<ul class="org-ul">
<li>размыкает реле, отвечающее за красный свет на светофоре;
</li>
<li>замыкает реле, отвечающее за зелёный свет на светофоре;
</li>
<li>возвращает стойку в режим ожидания;
</li>
<li>сообщает на сервер о закрытии шлагбаума.
</li>
</ul>
</div>
</li></ol>
</li></ol>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> Рампа</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Изменения касаются процедуры подъезда, всё начинается не с датчика присутствия у
стойки, а с датчика в начале "шлюза" из двух шлагбаумов - одного в начале участка
подъезда к стойке по рампе, второго - за стойкой. В данном решении присутсвуют три
датчика присутвия - на начале шлюза, у стойки и за стрелой, а также фотоэлемент на
линии стрелы.
</p>

<p>
1.1. Машина начинает заезд на рампу, с сенсорного устройства в начале рампы (контроллер петли индуктивность, фотоэлемент и т.п.) на контроллер отправляется сигнал.
1.2. Контроллер получает сигнал о том, что начат проезд рампы и переходит в режим ожидания освобождения сенсора.
1.3. Машина начинает подъём по рампе,  сигнал с сенсорного устройства прекращается (оно остаётся позади машины).
1.4. Контроллер фиксирует прекращение сигнала и блокирует рампу:
</p>
<ul class="org-ul">
<li>замыкает реле, отвечающее за закрытие шлагбаума №1, находящегося в начале рампы;
</li>
<li>замыкает реле, отвечающее за красный свет на светофоре в начале рампы;
</li>
<li>отправляет на сервер инфосообщение "Рампа занята".
</li>
</ul>
<p>
1.5. Машина подъезжает к стойке,  с сенсорного устройства у стойки (контроллер петли индуктивность, фотоэлемент и т.п.) на контроллер отправляется сигнал.
1.6. Контроллер получает сигнал о том, что у стойки находится машина и инициирует процедуру инициации проезда.
1.7. На сервер отправляет инфосообщение "Машина у стойки въезда".
5.3. Контроллер открывает шлагбаум в начале рампы, зажигает зелёный свет на светофоре в начале рампы.
5.4. На сервер отправляется сообщение "Рампа свободна".
</p>
</div>
</div>

<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3"><span class="section-number-4">2.3.3</span> Проезд по карте СКУД</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
Карты СКУД формата Em-Marine могут использоваться параллельно с билетами или
картами Mifare (основным въездным документом). Они вносятся в базу данных
администратором парковки и имеют ряд опций и статусов о которых подробнее будет
написано в описании модуля СКУД. Если пользователь вместо нажатия кнопки выдачи
въездного документа прикладывает карту СКУД и она проходит успешно проверки - это
действие является инициирующим проезд.
</p>

<p>
2.1. Контроллер переводит периферийные устройства в режим обслуживания клиента:
</p>
<ul class="org-ul">
<li>включается подсветка кнопки печати билета;
</li>
<li>на дисплей выдаётся информационное сообщение "Нажмите кнопку и получите билет ИЛИ ПРИЛОЖИТЕ КАРТУ".
</li>
</ul>
<p>
2.2. Клиент прикладывает карту к считывателю карт. Сигнал со считывателя Em-Marine приходит на интерфейс Wiegand 26.
2.3. Контроллер получает сигнал о том, что приложена карат имеющая номер NNNNNNNN.
2.4. Контроллер отправляет запрос на проверку статуса карты на сервер. Сервер обрабатывает запрос и возвращает контроллеру информацию о статусе карты:
</p>
<ul class="org-ul">
<li>"есть в БД" / "нет в БД" ;
</li>
<li>"на парковке" / "вне парковки";
</li>
<li>"заблокирована" / "активна";
</li>
<li>"есть места для данной группы" / "нет мест для данной группы".
</li>
</ul>
<p>
2.5. Контроллер получает ответ от сервера и на его основании решает - пускать ли владельца карты на парковку или нет.
2.6. Если сигнала связи с сервером нет, то контроллер проверяет свою БД и опрашивает другие контроллеры, которые видит в сети. Решение принимается на базе самой новой из доступных записей о статусе карты.
2.8. Если въезд разрешён, контроллер инициирует процедуру проезда.
2.9. На сервер отправляет инфосообщение "Приложена карта NNNNNNNN, въезд разрешен".
</p>
</div>
</div>

<div id="outline-container-sec-2-3-4" class="outline-4">
<h4 id="sec-2-3-4"><span class="section-number-4">2.3.4</span> <span class="todo WAIT">WAIT</span> Фотофиксация въезда</h4>
<div class="outline-text-4" id="text-2-3-4">
<p>
В пилотном проекте не реализуем, но - задел на будущее
</p>

<p>
Опциональное действие, которое может совершаться параллельно с любым действием
контроллера (выбирается в настройках контроллера). В процессе фотофиксации камера
(или камеры), IP которой указан в настройках контролера, получает запрос на
фотографирование, после чего возвращает контроллеру фото, которое сохраняетя им на
SD носитель.
</p>
</div>
</div>

<div id="outline-container-sec-2-3-5" class="outline-4">
<h4 id="sec-2-3-5"><span class="section-number-4">2.3.5</span> <span class="todo WAIT">WAIT</span> Звуковое сопровождение</h4>
<div class="outline-text-4" id="text-2-3-5">
<p>
В пилотном проекте не реализуем, но - задел на будущее
</p>

<p>
Опциональное действие, которое может совершаться параллельно с выводом сообщений на
дисплей, дублируя их аудиозаписями, лежащими на SD носители. Данные аудиофайлы
должны загружаться и сопоставляться с текстовыми сообщениями через интерфейс
настройки контроллера.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Состояния стойки при выезде</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Выезд практически полностью аналогичен въезду, поэтому будем писать только
отличия. Основное различие - проверка статуса оплаты, а также возможность вклинить
процедуру оплаты непосредственно в процесс.
</p>
</div>

<div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> Стойка в режиме ожидания (<code>standby</code>)</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
Так же как и на вьезде, но другой диалог. Например: можно поднести чек к сканеру и он
напишет - требуется оплата / не требуется оплата.
</p>
</div>
</div>

<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2"><span class="section-number-4">2.4.2</span> Подъезд машины к стойке (<code>finding</code>)</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
Идентично вьезду
</p>
</div>
</div>

<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3"><span class="section-number-4">2.4.3</span> Стойка в диалоговом режиме (<code>dialog</code>)</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
После срабатывания датчика присутствия стойка начинает диалог с посетителем, выводя
на дисплей сообщения о необходимости совершения действий, ошибок и т.п. После
прикладывания пользователем въездного документа, либо оплатного документа, либо
карты СКУД, стойка совершает проверку возможности выезда, статус оплаты и так
далее. На этом этапе осуществляется арбитраж в случае использования реверсивного
проезда (один шлагбаум на две стойки с разных сторон) или использования двух стоек
для левого и правого руля. Также на этом этапе выезд может быть совмещён с оплатой
и между процедурами 2 и 3 выполняется процедура оплаты, как на автоматическом
кассовом терминале.
</p>

<p>
Разрешение для посетителя на пребывание на парковке в течение определенного
промежутка времени задается арендатором. При этом клиентская программа арендатора
шлет информацию на центральный сервер, а центральный сервер сохраняет информацию и
транслирует ее контроллеру. Контроллер сохраняет полученную информацию в
памяти. При выезде автомобиля контроллер проверяет, истек срок пребывания на
парковке или нет, и разрешает или запрещает выезд. Время выезда передается на
центральный сервер.
</p>

<p>
Есть диалоговый режим, который при неплаченном проезде приводит процедуре оплаты
</p>
</div>
</div>

<div id="outline-container-sec-2-4-4" class="outline-4">
<h4 id="sec-2-4-4"><span class="section-number-4">2.4.4</span> <span class="todo WAIT">WAIT</span> Процедура оплаты (<code>payment</code>)</h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
В пилотном проекте мы пострараемся избежать реализации этого.
</p>

<p>
Это состояние может быть активировано и после <code>dialog</code> и после <code>standby</code>. Может
быть касса, совмещенная с выездом, на ней есть и торговое
оборудование. Пользователь может прийти пешком из <code>standby</code> и оплатить или
подьехать - тогда входом может быть любое состояние и выходом может быть <code>standby</code>
или <code>init</code>.
</p>
</div>
</div>

<div id="outline-container-sec-2-4-5" class="outline-4">
<h4 id="sec-2-4-5"><span class="section-number-4">2.4.5</span> Инициация процедуры выезда (<code>init</code>)</h4>
<div class="outline-text-4" id="text-2-4-5">
<p>
Идентично вьезду
</p>
</div>
</div>

<div id="outline-container-sec-2-4-6" class="outline-4">
<h4 id="sec-2-4-6"><span class="section-number-4">2.4.6</span> Процедура проезда (<code>goon</code>)</h4>
<div class="outline-text-4" id="text-2-4-6">
<p>
Идентично вьезду
</p>
</div>
</div>

<div id="outline-container-sec-2-4-7" class="outline-4">
<h4 id="sec-2-4-7"><span class="section-number-4">2.4.7</span> Процедура завершения въезда (<code>fin</code>)</h4>
<div class="outline-text-4" id="text-2-4-7">
<p>
Процесс закрытия шлагбаума после проезда машины, отправки итоговых данных о
совершённом проезде на сервер и возвращения стойки в режим ожидания.
</p>

<p>
Особенность - аннулирование вьездного документа
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Примеры алгоритмов</h3>
<div class="outline-text-3" id="text-2-5">
</div><div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> Алгоритм простого выезда по чеку</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
Простейший алгоритм для парковки, работающей по чекам с стандартным комплектом
датчиков и контроля проезда. В алгоритм введены светофор и счётчик мест
(светодиодное табло).
</p>

<ol class="org-ol">
<li><code>Подъезд машины</code>
</li>
</ol>
<p>
1.1. Машина подъезжает к стойке, с сенсорного устройства у стойки (контроллер петли индуктивность, фотоэлемент и т.п.) на контроллер отправляется сигнал.
1.2. Контроллер получает сигнал о том, что у стойки находится машина и из режима ожидания переховодит стойку в активный режим.
1.3. Замыкается реле, отвечающее за красный сигнал на светофоре.
1.4. На сервер отправляет инфосообщение "Машина у стойки выезда".
</p>
<ol class="org-ol">
<li><code>Активный режим (диалог с пользователем)</code>
</li>
</ol>
<p>
2.1. Контроллер переводит периферийные устройства в режим обслуживания клиента:
</p>
<ul class="org-ul">
<li>активируется широкополосный сканер штрих-кода;
</li>
<li>на дисплей выдаётся информационное сообщение "Поднесите билет".
</li>
</ul>
<p>
2.2. Клиент подносит билет штрих-кодом к сканеру, данные по RS232 или USB передаются на контроллер.
2.3. Контроллер  расшифровывает с помощью ключа шифрования (аналогичный стоит на въезде и кассах) штрих-код, получая из него информацию об оставшемся бесплатном времени (со времени въезда или времени оплаты). Он решает, исходя из заложенных в себя тарифов и параметров времени, разрешёен въезд или требуется оплата времени. см. "ПРОВЕРКА РАЗРЕШЕНИЯ ВЫЕЗДА"
2.4. Исходя из результатов проверки контроллер выводит на дислпей сообщение "Выезд разрешён" или "Выезд запрещён, оплатите $$$ руб".
2.5. Если выезд запрещён, контроллер блокирет перефирию, защищая систему от повторного прикладывания чека.
2.6. Контроллер сообщает на сервер "Выезд по билету №".
</p>
<ol class="org-ol">
<li><code>Инициация проезда</code>
</li>
</ol>
<p>
3.1. Контроллер получает положительный ответ от внутренних и внешних механизмов проверки оплаты билета и инициирует процедуру проезда.
3.2. Контроллер  замыкает реле, отвечающее за открытие шлагбаума  за стойкой (реле замкнуто либо до прихода на сенсорный ввод сигнала "открыт", либо по длине импульса из настроек контроллера)
3.3. Контроллер сообщает серверу "Открытие шлагбаума стойки №"
</p>
<ol class="org-ol">
<li><code>Процедура проезда</code>
</li>
</ol>
<p>
4.1. Когда стрела шлагбаума открывается, в шлагбауме срабатывает концевик открытия - сигнал с него приходит на сенсор "открытие" контроллера
4.2. Контроллер фиксирует факт того, что шлагбаум в открытом положении совершаются следующие действия:
</p>
<ul class="org-ul">
<li>замыкает реле, отвечающее за зелёный свет на светофоре;
</li>
<li>размыкает реле, отвечающее за красный свет на светофоре;
</li>
<li>сообщает серверу "Шлагбаум стойки № открыт"
</li>
</ul>
<p>
4.3. Когда машина пересекает линию фотоэлемента безопасности (стрелы шлагбаума) с ф/э приходит сигнал на сэнсор.
4.4. Контроллер, имея сигнал с ф/э безопасности на сенсор, переходит в режим "стоп" - пока сенсор не освобождён стрела шлагбаума не должна закрыться.
4.5. Машина проезжает шлагбаум,  с сенсорного устройства за его стрелой (контроллер петли индуктивности, фотоэлемент, датчик МП) на контроллер отправляется сигнал.
4.6. Контроллер получает подтверждение завершения проезда и начинает соответсвующую процедуру.
</p>
<ol class="org-ol">
<li><code>Процедура завершения проезда</code>
</li>
</ol>
<p>
5.1. Получив подтверждение окончания проезда - нет сигнала на сенсор безопасности проезда и на сенсор петли за шлагбаумом - контроллер инициирует следующеи действия:
</p>
<ul class="org-ul">
<li>размыкает реле, отвечающее за зелёный свет на светофоре;
</li>
<li>замыкает реле, отвечающее за красный свет на светофоре;
</li>
<li>замыкает реле, отвечающее за закрытие шлагбаума за стойкой (реле замкнуто либо до прихода на сенсорный ввод сигнала "закрыт" с концевика, либо по длине импульса из настроек контроллера)
</li>
<li>сообщает серверу "выезд по билету № успешно завершен", а также об изменении количества мест в секторе и данные по билету
</li>
<li>отправляет на табло счётчика мест по RS-485 сообщение "-1 место"
</li>
</ul>
<p>
5.2. Получив сигнал с концевика закрытия на сенсор контроллер:
</p>
<ul class="org-ul">
<li>размыкает реле, отвечающее за красный свет на светофоре;
</li>
<li>замыкает реле, отвечающее за зелёный свет на светофоре;
</li>
<li>возвращает стойку в режим ожидания;
</li>
<li>сообщает на сервер о закрытии шлагбаума.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2"><span class="section-number-4">2.5.2</span> Проезд по карте СКУД</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
Карты СКУД формата Em-Marine могут использоваться параллельно с билетами или картами
Mifare (основным въездным документом). Они вносятся в базу данных администратором
парковки и имеют ряд опций и статусов о которых подробнее будет написано в описании
модуля СКУД. Если пользователь вместо нажатия кнопки выдачи въездного документа
прикладывает карту СКУД и она проходит успешно проверки - это действие является
инициирующим проезд.
</p>

<p>
2.1. Контроллер переводит периферийные устройства в режим обслуживания клиента:
</p>
<ul class="org-ul">
<li>включается подсветка кнопки печати билета;
</li>
<li>на дисплей выдаётся информационное сообщение "Нажмите кнопку и получите билет ИЛИ ПРИЛОЖИТЕ КАРТУ".
</li>
</ul>
<p>
2.2. Клиент прикладывает карту к считывателю карт. Сигнал со считывателя Em-Marine приходит на интерфейс Wiegand 26.
2.3. Контроллер получает сигнал о том, что приложена карат имеющая номер NNNNNNNN.
2.4. Контроллер отправляет запрос на проверку статуса карты на сервер. Сервер обрабатывает запрос и возвращает контроллеру информацию о статусе карты:
</p>
<ul class="org-ul">
<li>"есть в БД" / "нет в БД" ;
</li>
<li>"на парковке" / "вне парковки";
</li>
<li>"заблокирована" / "активна";
</li>
<li>"есть места для данной группы" / "нет мест для данной группы".
</li>
</ul>
<p>
2.5. Контроллер получает ответ от сервера и на его основании решает - пускать ли владельца карты на парковку или нет.
2.6. Если сигнала связи с сервером нет, то контроллер проверяет свою БД и опрашивает другие контроллеры, которые видит в сети. Решение принимается на базе самой новой из доступных записей о статусе карты.
2.8. Если въезд разрешён, контроллер инициирует процедуру проезда.
2.9. На сервер отправляет инфосообщение "Приложена карта NNNNNNNN, выезд разрешен".
</p>
</div>
</div>

<div id="outline-container-sec-2-5-3" class="outline-4">
<h4 id="sec-2-5-3"><span class="section-number-4">2.5.3</span> <span class="todo WAIT">WAIT</span> Фотофиксация въезда</h4>
<div class="outline-text-4" id="text-2-5-3">
<p>
В пилотнике не надо
</p>

<p>
Опциональное действие, которое может совершаться параллельно с любым действием
контроллера (выбирается в настрйоках контроллера). В процессе фотофиксации камера
(или камеры), IP которой указан в настройках контролера, получает запрос на
фотографирование, после чего возвращает контроллеру фото, которое сохраняетя им на
SD носитель.
</p>
</div>
</div>

<div id="outline-container-sec-2-5-4" class="outline-4">
<h4 id="sec-2-5-4"><span class="section-number-4">2.5.4</span> Звуковое сопровождение</h4>
<div class="outline-text-4" id="text-2-5-4">
<p>
В пилотнике не надо
</p>

<p>
Опциональное действие, которое может соврешаться параллельно с
выводом сообщений на дисплей, дублируя их аудиозаписями, лежащими
на SD носители. Данные аудиофайлы должны загружаться и
сопоставляться с текстовыми сообщениями через интерфейс настройки
контроллера.
</p>
</div>
</div>

<div id="outline-container-sec-2-5-5" class="outline-4">
<h4 id="sec-2-5-5"><span class="section-number-4">2.5.5</span> <span class="todo TODO">TODO</span> Работа с автоматической кассой</h4>
<div class="outline-text-4" id="text-2-5-5">
<p>
АЛГОРИТМЫ СКОПИРОВАНЫ ИЗ ПАСПОРТА КАССЫ, В ПРОЦЕССЕ ДОРАБОТКИ
</p>
</div>
</div>

<div id="outline-container-sec-2-5-6" class="outline-4">
<h4 id="sec-2-5-6"><span class="section-number-4">2.5.6</span> <span class="todo TODO">TODO</span> Процедура оплаты</h4>
<div class="outline-text-4" id="text-2-5-6">
<p>
Это последовательность действий посетителя и оператора парковки
при проведении оплаты через автоматическую кассу.
</p>

<ol class="org-ol">
<li>Посетитель находится у кассы.
</li>
</ol>
<p>
1.1. Подносит неоплаченный въездной билет или просроченный выездной чек к сканеру штрих-кода.
1.2. Если посетитель потерял въездной билет или выездной чек, то он должен нажать кнопку "Оплата за утерю билета" (точная формулировка может отличаться).
</p>
<ol class="org-ol">
<li>На дисплее выводится информация о необходимых операциях.
</li>
</ol>
<p>
2.1. В случае, если бесплатное или ранее оплаченное время ещё не истекло, на дисплей будет выведена информация об оставшемся времени нахождения на парковке.
2.2. Если посетитель пробыл на парковке больше установленного бесплатного времени и не провёл оплату на другой кассе или производит оплату за утерю билета, система рассчитает сумму, требуемую к оплате, исходя из установленных для стойки тарифов, выведет на дисплей информацию о необходимости и размере платежа и активирует платёжное оборудование.
</p>
<ol class="org-ol">
<li>Посетитель оплачивает услуги АПС наличными через купюроприемник (банкноты номиналом 50, 100, 500, 1000 и 5000 руб.; мод. К, БК, КМ, БКМ), монетоприёмник (монеты номиналом 1, 2, 5 и 10 руб., мод. М, КМ, БМ, БКМ) или банковской карточкой (мод. Б, БК, БМ, БКМ).
</li>
</ol>
<p>
3.1. Если оплата производится купюрами или монетами, и при внесении платежа была совершена ошибка, возможно вернуть деньги нажав кнопку "Возврат денег".
3.2. Если оплата производится монетами, и при внесении платежа монету заклинило в монетоприёмнике, необходимо нажать на кнопку "Сброс монеты" под прорезью для монет.
3.3. Если оплата производится с помощью банковской карты, то для активации POS-терминала необходимо нажать кнопку "Оплата картой".
</p>
<ol class="org-ol">
<li>После оплаты касса выдаёт выездной чек и, в случае, если посетитель оплатил наличными и сумма вносимых средств превысила требуемую, сдачу. При этом на мониторе отображается оставшееся время, в соответствии с установленными тарифами, в течение которого посетитель должен покинуть парковку.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-5-7" class="outline-4">
<h4 id="sec-2-5-7"><span class="section-number-4">2.5.7</span> <span class="todo TODO">TODO</span> Процедура инкассации</h4>
<div class="outline-text-4" id="text-2-5-7">
<ol class="org-ol">
<li>Запросить "Х-отчет" и забрать чек. п. 3 и п. 4 только для модификаций с купюрами (К, БК, КМ, БКМ)
</li>
<li>Изъять банкнотную наличность.
</li>
</ol>
<p>
3.1. Снять бокс купюроприёмника
3.2. Изъять купюры из бокса или взять пустой бокс купюроприёмника
3.3. Установить пустой бокс купюроприемника на место.
</p>
<ol class="org-ol">
<li>Восполнить банкнотную наличность для сдачи.
</li>
</ol>
<p>
4.1. Снять кассеты диспенсера с купюрами сдачи и кассету "Отказ".
4.2. Заполнить кассеты купюрами или взять предварительно заполненные сдачей новые кассеты. Изъять неликвидные купюры из кассеты "Отказ".
4.3. Установить кассеты на место.
</p>
<ol class="org-ol">
<li>Провести инкассацию и закрыть смену.
</li>
</ol>
<p>
5.1. Нажать кнопку "Инкассация" и забрать чек с данными об инкассации. п. 6 и п. 7 только для модификаций с монетами (М, КМ, БМ, БКМ)
</p>
<ol class="org-ol">
<li>Изъять полученные монеты из специального металлического ящика.
</li>
<li>После нажатия "Инкассации" выполнить перезагрузку сдачи в хопперы.
</li>
</ol>
<p>
7.1. Хопперы автоматически поочерёдно осуществят сброс всех не выданных в качестве сдачи монет в окно выдачи сдачи или в предварительно размещённую под желобами для монет ёмкость. 7.2. Загрузите в хопперы сдачу в соответствии с установленным по умолчанию количеством сдачи. п. 8 только для модификаций с банковскими картами (Б, БК, БМ, БКМ)
</p>
<ol class="org-ol">
<li>После нажатия "Инкассации" POS-терминал обменивается данными с банком, после чего в чек инкассации включается отчёт об эквайринговых операциях.
</li>
<li>Если на дисплее отображается надпись "Заблокировано", необходимо нажать кнопку "Разблокировка", после чего будет напечатан тестовый чек и выведена надпись "Поднесите штрих-код или карту".
</li>
<li>Закрыть дверь кассы.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-5-8" class="outline-4">
<h4 id="sec-2-5-8"><span class="section-number-4">2.5.8</span> <span class="todo TODO">TODO</span> Процедура закрытия смены</h4>
<div class="outline-text-4" id="text-2-5-8">
<p>
[TODO:Rigidus] - Почитать про кассовый регламент, что такое Z-отчет
</p>

<ol class="org-ol">
<li>Запросить "Z-отчет", закрыть фискальную смену и забрать чек. Сверить суммы прибыли с чеками инкассаций и фактической прибылью.
</li>
<li>Новая смена открывается автоматически при следующей оплате.
</li>
<li>Если на дисплее отображается надпись "Заблокировано", необходимо нажать кнопку "Разблокировка", после чего будет напечатан тестовый чек и выведена надпись "Поднесите штрих-код или карту".
</li>
<li>Закрыть кассу.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-5-9" class="outline-4">
<h4 id="sec-2-5-9"><span class="section-number-4">2.5.9</span> <span class="todo TODO">TODO</span> Работа контроллера при обрыве связи с сервером</h4>
<div class="outline-text-4" id="text-2-5-9">
<p>
Работа контроллера в случае обрыва связи с сервером
осуществляется следующим образом. Билет считывается сканером
штрих кодов. Время и код билета сохраняются в памяти
контроллера. Решение об открытии ворот принимается охранником (на
билете напечатано время въезда). При восстановлении связи архив
информации о билетах передается на центральный сервер.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Особенности секторальности и тарификации</h2>
<div class="outline-text-2" id="text-3">
<p>
Необходимо реализовать гибкую систему тарифов, при этом постаравшись максимально сохранить автномность системы в случае падения связи с сервером.
Основные единые настройки бесплатного времени:
</p>
<ul class="org-ul">
<li>бесплатное время после въезда (мин)
</li>
<li>бесплатное время на выезд после оплаты (мин)
</li>
</ul>

<p>
Эти характеристики должны быть индивидуальны для разных секторов парковки. Т.е.,
например, в секторе открытого паркинга одни тарифы, а в секторе закрытого -
другие. Между секторами стоит проездная стойка со сканером штрих кодов (для Mifare
парковки это сделать проще в автономном режиме). При поднесении она переносит на
сервере и всех соседних стойках билет в другой сектор. При этом если машина отстояла
t1 времени в одном секторе, а потом поехала в другой, то данные по оплате
суммируется, а бесплатное время во втором секторе не считается.
</p>

<p>
Основые вещи:
</p>
<ul class="org-ul">
<li>Со скольки до скольки работает парковка (осуществляется впуск и выпуск)
Допустимо по картам СКУД пускать например круглосуточно, а по чекам - только днем
</li>
<li>Бесплатное время - время, которое машина может стоять на парковке до требования
оплаты. В течении его она может выехать бесплатно.
</li>
<li>Время на выезд - время за которое машина может покинуть парковку после оплаты
водителем в кассе. Если не успел - время на выезд не учитывается.
</li>
<li>Штраф - сумма, которая взимается с человека, если он потерял вьездной документ.
</li>
<li>Стоимость часов [TODO:pyub]:
Имеются следующие основыне тарифные характеристики:
<ul class="org-ul">
<li>стоимость 1го..2го..23го..24го.. часа после истечения бесплатного времени
</li>
</ul>
</li>
<li>коэффициент стоймости в зависимости от времени суток (с 20:00 до 22:00 k=2, с 9:00 до 18:00 k=0,5)
</li>
<li>коэффицикнт стоймости в зависимости от дня недели (пн, вт, ср, чт, пт k2=1, сб,вс k2=2)
</li>
<li>Секторальность - например есть крытая и открытая система парковки, между ними
стойка. Если пользователь на ночь хочет на закрытую парковку - там другой тариф,
все это надо считать суммируя. В пилотном проекте не делаем, но учитывать нужно при
программировании системы тарифов.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Протоколы обмена данными</h2>
<div class="outline-text-2" id="text-4">
<p>
Контроллеры и рабочие станции соединяются с центральным сервером по локальной сети,
используя стек протоколов TCP/IP.
</p>

<p>
Некоторые периферийные компоненты системы могут связываться с контроллерами или
непосредственно с сервером и рабочими станциями по интерфейсу RS-485
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Контроллер (требования)</h2>
<div class="outline-text-2" id="text-5">
<p>
Новый контроллер парковочной системы должен быть разработан в соответствии со
следующими критериями:
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Гибкость системы</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Плата и программное обеспечение должны быть выполнены так, чтобы была возможность
масштабирования системы и при этом сохранения обратной совместимости программного
обеспечения. Например, в определённый момент возникнет необходимость увеличить
количество реле или COM-портов на плате, будет осуществлена доработка связанная с
переразводкой, но при этом на новых контроллерах должно штатно работать и старое ПО,
а на старых контроллерах работать новое ПО.
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Web-интерфейс для настройки контроллера</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Микроконтроллер должен иметь собственный Web-сервер для возможности доступа к его
настройкам через локальную сеть по IP адресу и наличия функции перепрошивки и
обновления программного обеспечения контроллера без физического доступа к нему.
</p>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Обработка аудио</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Наличие модуля обработки аудио, аппаратного или возможности установки программного
эккалайзера
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Работа с дисплеями</h3>
<div class="outline-text-3" id="text-5-4">
<p>
монохромный 2,4строки и полноцветнный габаритами
</p>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Периферийные устройства контроллера и протоколы связи</h3>
<div class="outline-text-3" id="text-5-5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Периферийное оборудовани</caption>

<colgroup>
<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">&#xa0;</th>
<th scope="col" class="left">Тип устройства</th>
<th scope="col" class="left">Предлагаемая модель</th>
<th scope="col" class="left">Интерфейс подключения</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">1</td>
<td class="left">Термопринтер</td>
<td class="left">Custom VKP80II</td>
<td class="left">RS-232 / USB</td>
</tr>

<tr>
<td class="right">2</td>
<td class="left">Фискальный регистратор</td>
<td class="left">Искра ПРИМ-21К 03</td>
<td class="left">RS-232 / USB</td>
</tr>

<tr>
<td class="right">3</td>
<td class="left">Сканер штрихкодов широкополосный</td>
<td class="left">Honywell IS3480 QuantumE</td>
<td class="left">RS-232 / USB</td>
</tr>

<tr>
<td class="right">4</td>
<td class="left">Сканер штрихкода / QR-кода</td>
<td class="left">не выбрана</td>
<td class="left">RS-232 / USB</td>
</tr>

<tr>
<td class="right">5</td>
<td class="left">Диспенсер карт Mifare+</td>
<td class="left">не выбрана</td>
<td class="left">RS-232 / USB</td>
</tr>

<tr>
<td class="right">6</td>
<td class="left">Картоприёмник Mifare+</td>
<td class="left">не выбрана</td>
<td class="left">RS-232 / USB</td>
</tr>

<tr>
<td class="right">7</td>
<td class="left">Считыватель карт Mifare+Matrix II MF-I</td>
<td class="left">Wiegand 26</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">8</td>
<td class="left">Считыватель карт Em-MarineIron Logic Matrix V / Matrix II EH</td>
<td class="left">Wiegand 26</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">9</td>
<td class="left">Дисплей монохромный символьный 16*4</td>
<td class="left">Winstar / Long</td>
<td class="left">6800 / SPI</td>
</tr>

<tr>
<td class="right">10</td>
<td class="left">Дисплей цветной графический TFT-LCD</td>
<td class="left">Winstar / Long</td>
<td class="left">RGB / MCU</td>
</tr>

<tr>
<td class="right">11</td>
<td class="left">Купюроприемник</td>
<td class="left">CashCode SM (MSM)</td>
<td class="left">ID003 / CCNET</td>
</tr>

<tr>
<td class="right">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">ICT L77F</td>
<td class="left">RS-232</td>
</tr>

<tr>
<td class="right">12</td>
<td class="left">Монетоприемник</td>
<td class="left">ICT UCA2</td>
<td class="left">RS-232</td>
</tr>

<tr>
<td class="right">13</td>
<td class="left">Диспенсер купюр</td>
<td class="left">Puloon LCDM-1000/2000/4000</td>
<td class="left">RS-232</td>
</tr>

<tr>
<td class="right">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">ICT ND 300 KM</td>
<td class="left">RS-232</td>
</tr>

<tr>
<td class="right">14</td>
<td class="left">Хоппер</td>
<td class="left">ICT Leonid Mini Hopper</td>
<td class="left">ccTalk / Hopper</td>
</tr>

<tr>
<td class="right">15</td>
<td class="left">Ресайклер монет</td>
<td class="left">не выбрана</td>
<td class="left">RS-232</td>
</tr>

<tr>
<td class="right">16</td>
<td class="left">POS банк-терминал</td>
<td class="left">не выбрана</td>
<td class="left">RS-232 / USB / Ethernet</td>
</tr>

<tr>
<td class="right">17</td>
<td class="left">Табло счётчика мест / инфотабло</td>
<td class="left">не выбрана</td>
<td class="left">RS-485</td>
</tr>

<tr>
<td class="right">18</td>
<td class="left">Ультразвуковой датчик наличия машины</td>
<td class="left">не выбрана</td>
<td class="left">RS-485</td>
</tr>

<tr>
<td class="right">19</td>
<td class="left">Магнитный датчик наличия машины</td>
<td class="left">не выбрана</td>
<td class="left">RS-485</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Выводы на аудио оборудование</h3>
<div class="outline-text-3" id="text-5-6">
<p>
Делаем в пилотнике. Поднимаем Астерикс
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> Аудио-оборудование</caption>

<colgroup>
<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">&#xa0;</th>
<th scope="col" class="left">Тип устройства</th>
<th scope="col" class="left">Предлагаемая модель</th>
<th scope="col" class="left">Интерфейс подключения</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">20</td>
<td class="left">Вывод на динамик</td>
<td class="left">Jack 3,5 мм TS</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">21</td>
<td class="left">Вывод на микрофон</td>
<td class="left">Jack 3,5 мм TS</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> Выводы на сухой контакт реле</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Это реле.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> Выходы - сухой контакт</caption>

<colgroup>
<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">&#xa0;</th>
<th scope="col" class="left">Тип устройства</th>
<th scope="col" class="left">Предлагаемая модель</th>
<th scope="col" class="left">Интерфейс подключения</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">22</td>
<td class="left">Шлагбаум вверх</td>
<td class="left">R1</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">23</td>
<td class="left">Шлагбаум вниз</td>
<td class="left">R2</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">24</td>
<td class="left">Шлагбаум стоп</td>
<td class="left">R3</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">25</td>
<td class="left">Светофор сигнал 1</td>
<td class="left">R4</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">26</td>
<td class="left">Светофор сигнал 2</td>
<td class="left">R5</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">27</td>
<td class="left">Светофор сигнал 3</td>
<td class="left">R6</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">28</td>
<td class="left">Арбитраж вывод</td>
<td class="left">R7</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">29</td>
<td class="left">Доп. реле управления смежными устр.</td>
<td class="left">R8</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">30</td>
<td class="left">Доп. реле управления смежными устр.</td>
<td class="left">R9</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">31</td>
<td class="left">Доп. реле управления смежными устр.</td>
<td class="left">R10</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> Выводы на сенсоры и кнопки</h3>
<div class="outline-text-3" id="text-5-8">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> Это вводы</caption>

<colgroup>
<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">&#xa0;</th>
<th scope="col" class="left">Тип устройства</th>
<th scope="col" class="left">Предлагаемая модель</th>
<th scope="col" class="left">Интерфейс подключения</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">32</td>
<td class="left">Датчик присутсвия автомобиля А</td>
<td class="left">S1</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">33</td>
<td class="left">Датчик присутсвия автомобиля Б</td>
<td class="left">S2</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">34</td>
<td class="left">Датчик завершения проезда рампы</td>
<td class="left">S3</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">35</td>
<td class="left">Арбитраж ввод</td>
<td class="left">S4</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">36</td>
<td class="left">Концевки открытия шлагбаума</td>
<td class="left">S5</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">37</td>
<td class="left">Концевик закрытия шлагбаума</td>
<td class="left">S6</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">38</td>
<td class="left">Фотоэлемент безопасности</td>
<td class="left">S7</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">39</td>
<td class="left">Датчик грузового транспорта</td>
<td class="left">S8</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">40</td>
<td class="left">Универсальная кнопка 1</td>
<td class="left">S9</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">41</td>
<td class="left">Универсальная кнопка 2</td>
<td class="left">S10</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">42</td>
<td class="left">Универсальная кнопка 3</td>
<td class="left">S11</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">43</td>
<td class="left">Универсальная кнопка 4</td>
<td class="left">S12</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">44</td>
<td class="left">Универсальная кнопка 5</td>
<td class="left">S13</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">45</td>
<td class="left">Универсальная кнопка 6</td>
<td class="left">S14</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="right">46</td>
<td class="left">Общий</td>
<td class="left">S15</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Серверная часть</h2>
<div class="outline-text-2" id="text-6">
<p>
[TODO:pyub] - Дать Rigidus доступ к существующему серверу и БД
</p>

<p>
Серверную часть необходимо полностью переписать в соответствии со
следующими критериями:
</p>

<ul class="org-ul">
<li>Необходимо отойти от связки php+appche, сервер должен иметь
автономное ядро (бэкэнд, сервер приложений) которое возможно будет
развернуть на платформах ОС семейств Windows или Linux. Выбор
оптимальных средств (языка программирования) с помощью которых
будет реализована данная задача на данный момент является
приоритетной задачей.
</li>

<li>В качестве сервера БД предлагается использовать бесплатные системы
MySQL с базами InnoDB или PostgreSQL (выбор необходимо
аргументировать).
</li>

<li>Все требуемые администратору системы и конечному пользователю
интерфейсы и средства должны быть реализованы в кроссплатформенном
браузерном варианте. Т.е. система должна быть реализована по
принципу "одного окна" (или точнее "всё на одной вкладке
браузера"). В дальнейшем возможно создание клиентских приложений на
замену браузерной реализации, но данная задача не является
приоритетной.
</li>

<li>Сервер должен иметь модульную структуру как по функционалу, так и
по доступным конечным пользователям интерфейсам управления и
администрирования (фронтэнду). Модули должны подключаться к серверу
в процессе изначальной установки, либо легко подключаться
после. Необходимо предусмотреть возможность инсталляции модулей как
с носителя, так и из сетевого репозитория.
</li>

<li>Ядро сервера и модули должны иметь встроенные средства
защиты. Предполагается использование аппаратного ключа HASP или
RuToken (возможно аналогов) для ядра и отдельных программных ключей
лицензирования для подключения отдельных модулей.
</li>

<li>При создании сервера необходимо разработать APIи техническую
документацию для возможности дальнейшей интеграции нашего ПО с
системами СКУД, 1С и т.д.
</li>

<li>Необходима возможность объединения серверов в кластеры,
т.е. несколько локальных серверов на отдельных парковках должны
иметь возможность обмениваться информацией с центральным сервером в
центре управления. Центральный сервер же должен иметь приоритет над
локальными, имея возможность управлять СКД во всём кластере,
тарифами и т.д.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Основной функционал сервера:</h2>
<div class="outline-text-2" id="text-7">
<p>
В базовом варианте сервер должен иметь собственно ядро, БД и два
основных модуля (интерфейса) - администратора системы и парковщика.
</p>

<p>
Администратор системы должен иметь следующие возможности:
</p>

<ul class="org-ul">
<li>Получать информацию обо всех стойках и терминалах, находящихся в
локальной сети по факту настройки стоек на работу с данным сервером.
</li>

<li>Изменение IP-адресов, ключей шифрования, номеров стоек, управления
секторами, временем, информацией, выводимой на дисплей стоек и
печатаемой на чеках, подключения и удалённого программного
отключения периферийного оборудования на них (торговое
оборудование, светофоры, табло), гибкой настройки логики работы
сенсоров (фотоэлементов, магнитных петель).
</li>

<li>Получение информации агрегируемую сервером со стоек - события
въездов, выездов, оплаты, ошибки и т.п., которая должна писать в лог
и быть доступна для выгрузке по дате в отчёт в формате *.xls.
</li>

<li>Доступ к средствам тестирования работоспособности стоек (аналог
текущего ParkingTest).
</li>

<li>Управление пользователями системы, создание логинов и паролей,
распределение прав доступа к интерфейсам из-под учётных записей и
групп пользователей системы (в том числе и для самого себя).
</li>
</ul>

<p>
Оператор парковки должен иметь следующие возможности:
</p>

<ul class="org-ul">
<li>Открытие и закрытие шлагбаумов, подключённых к стойкам, находящимся
в локальной сети.
</li>

<li>Управление количеством свободных мест на парковке.
</li>

<li>Мониторинг информации, приходящей со стоек (лога) в режиме
реального времени.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Дополнительные модули сервера</h2>
<div class="outline-text-2" id="text-8">
<p>
Мы хотим продавать решение разным людям за разные деньги. Обосновать это им можно
только предоставляя разные версии функционала.
</p>

<p>
Дополнительные модули должны подключаться к системе по запросу клиента в тех или иных
сочетаниях. При этом, каждый из этих установленных модулей подключается
администратором системы конкретному пользователю (группе пользователей). Это
позволяет сегментировать стоимость решения по цене.
</p>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> Модуль <code>платной парковки</code></h3>
<div class="outline-text-3" id="text-8-1">
<p>
Добавляет возможность работы с оплатой парковочного времени и управляет тарифами на
парковке. В системы добавляется интерфейс администратор тарифов, с помощью которого
можно изменять почасовую стоимость пребывания на парковке, бесплатное время
пребывания на парковке, время бесплатного выезда с парковки после оплаты услуг и
т.д.
</p>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Модуль <code>СКУД</code></h3>
<div class="outline-text-3" id="text-8-2">
<p>
Добавляет возможность работы с бесконтактными картами доступа в безусловном режиме
разрешения / запрета въезда. В систему добавляется интерфейс администратора СКУД,
который позволяет заводить в систему карты доступа по их индивидуальному номеру,
вводить информацию о владельцах карт (ФИО, гос. номер транспортного средства и
т.п.), распределять карты по различным группам доступа. Группы доступа могут иметь
различные права по времени возможного въезда/выезда с парковки, по посещению тех или
иных секторов парковки, а также иметь численное ограничение количества въездов
(т.е. карт выдано в группе 10, но данной группе на парковке принадлежит только 5
мест и одновременно на парковке / в секторе парковки может находиться только 5
машин). Карты доступа могут временно блокироваться, переноситься в архивные и
окончательно удаляться администратором. Если установлены другие модули, работающие с
б/к картами, администратор может изменять тип карт с одного на другой (абонемент,
дебетовая). У оператора парковки при подключённом модуле СКУД в логе добавляются
сообщения о въездах и выездах по картам. Также добавляется интерфейс аудитора СКУД,
который позволяет пользователю с данными правами получить доступ к информации о
картах доступа, но не даёт возможности её изменять.
</p>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> Модуль для <code>работы с абонементами</code></h3>
<div class="outline-text-3" id="text-8-3">
<p>
Добавляет возможность работы с бесконтактными картами в режиме оплаты услуг парковки
владельцем карты на заданный срок - т.е. оплата на фиксированную сумму производится
один раз в установленный срок. В систему добавляется интерфейс администратора
абонементных карт,позволяющий заводить в систему абонементные карты по их
индивидуальному номеру, вводить информацию о владельцах карт (ФИО, гос. номер
транспортного средства, номер договора на предоставление услуг и т.п.), распределять
карты по различным группам доступа и тарифными группам. Группы доступа используются
те же, что и в модуле СКУД. Абонементные карты могут временно блокироваться,
переноситься в архивные и окончательно удаляться администратором. Если установлены
другие модули, работающие с б/к картами, администратор может изменять тип карт с
одного на другой (СКУД, дебетовая).В интерфейс администратора тарифов добавляется
возможность работы с тарифными группами, сроками и стоимостью оплаты для
абонементов.У оператора парковки, при подключённом модуле работы с абонементами, в
логе добавляются сообщения о въездах и выездах по картам и сроке действия
карт. Также добавляется интерфейс аудитора абонементных карт, который позволяет
пользователю с данными правами получить доступ к информации об абонементных картах
исроках оплаты клиентом услуг, но не даёт возможности её изменять.
</p>
</div>
</div>

<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> Модуль для <code>работы по дебетовым картам</code></h3>
<div class="outline-text-3" id="text-8-4">
<p>
Добавляет возможность работы с бесконтактными картами в режиме оплаты услуг парковки
владельцем карты по специальному тарифу - т.е. он кладёт деньги на карту через
кассу, сумма фиксируется в платёжной системе парковки и далееденьги списываются с
него исходя из времени пребывания на парковке при выездах, но по особым тарифам. В
систему добавляется интерфейс администратора дебетовых карт,позволяющий заводить в
систему дебетовые карты по их индивидуальному номеру, вводить информацию о
владельцах карт (ФИО, гос. номер транспортного средства, номер договора на
предоставление услуг и т.п.), распределять карты по различным группам доступа и
тарифными группам. Группы доступа используются те же, что и в модуле СКУД. Дебетовые
карты могут временно блокироваться, переноситься в архивные и окончательно удаляться
администратором. Если установлены другие модули, работающие с б/к картами,
администратор может изменять тип карт с одного на другой (СКУД, абонементная).В
интерфейс администратора тарифов добавляется возможность работы с тарифными группами
и стоимостью времени пребывания на парковке для дебетовых карт.У оператора парковки,
при подключённом модуле работы с дебетовыми картами, в логе добавляются сообщения о
въездах и выездах по картам и списанных со счёта средствах. Также добавляется
интерфейс аудитора дебетовых карт, который позволяет пользователю с данными правами
получить доступ к информации о дебетовых картах, состоянии счёта клиента и тарифном
плане, но не даёт возможности ничего изменять.
</p>
</div>
</div>

<div id="outline-container-sec-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> Модуль <code>акцептирования</code></h3>
<div class="outline-text-3" id="text-8-5">
<p>
Добавляет в систему возможность обнуления требующего оплаты билета со штриховым
кодом через интерфейсную оболочку. В систему добавляется интерфейс акцептирования
билета в котором пользователь может ввести в специальное поле номер билета (или
считать номер сканером штрих-кода) и произвести либо безусловное акцептирование -
сделать билет бесплатным для выезда навсегда изменив информацию о нём на сервере и
выездных стойках, либо акцептирование на выезде- у клиента будет возможность
покинуть парковку в течении бесплатного времени после акцептирования, либо
акцептирование по тарифу - данному билету присваивается специальный тариф
(используется список тарифов дебетового режима) и стоимость пребывания на парковке
пересчитывается исходя из него. При акцептировании пользователь вводит комментарий,
в котором пишется причина акцептирования. Вся информация о проведённых
акцептированиях билетов (пользователь, номер билета, время акцептирования, сумма
акцептирования) пишется в лог и доступна для ознакомления в интерфейсе аудитора
акцептирования.
</p>
</div>
</div>

<div id="outline-container-sec-8-6" class="outline-3">
<h3 id="sec-8-6"><span class="section-number-3">8.6</span> Модуль <code>арендаторов</code></h3>
<div class="outline-text-3" id="text-8-6">
<p>
Добавляет в систему возможность обнуления требующего оплаты билета со штриховым
кодом на кассах, стойках информации или через интерфейсную оболочку с помощью карты
арендатора с последующим списанием обнулённой суммы на счёт владельца карты. В
систему добавляется интерфейс администрирования арендаторов, в котором можно
создавать пользователей - "арендаторов" и привязывать их бесконтактным картам и
основным пользователям системы. Каждому арендатору выдаётся своя бесконтактная
карта, для которой в системе администратором установлен режим акцептирования (режимы
перечислены в описании модуля акцептирования, для дебетового режима устанавливается
тариф). С помощью этой карты арендатор может акцептировать билет клиента, приложив
сначала билет, а затем карту к стойке информации, кассе или введя номер билета на
ПК, а затем приложив карту к считывателю на ПК. После этого клиент покидает парковку
в соответствии с правилами акцептирования, а акцептированная сумма переводится на
"овердрафтовый счёт" данного арендатора в системе. Все данные по этому счёту
отображаются в интерфейсе счета арендаторов. Через этот интерфейс можно либо списать
сумму, которую должен арендатор, либо распечатать фискальный чек через ККМ,
подключённый к ПК, либо выгрузить форму счёта на оплату в банке.
</p>
</div>
</div>

<div id="outline-container-sec-8-7" class="outline-3">
<h3 id="sec-8-7"><span class="section-number-3">8.7</span> Модуль <code>кассира</code></h3>
<div class="outline-text-3" id="text-8-7">
<p>
Добавляет в систему возможность оплаты услуг парковки через ручную кассу на базе ПК
к которому подключён ККМ и, опционально, денежный ящик и сканер штриховых кодов. В
систему добавляются интерфейсы кассир и кассир - парковщик. В интерфейсе кассира
пользователь может провести процедуру оплаты билета - вбить его номер (или считать
номер сканером штрих-кода), выбрать тариф оплаты, принять сумму к оплает и
распечатать выездной фискальный чек с суммой, рассчитанной системой исходя из
времени и тарифа. При этом приём денег и выдача сдачи осуществляется непосредственно
человеком. Кассир-парковщик имеет интерфейс оплаты совмещённый с интерфейсом
обычного оператора парковки в котором есть возможность открытия и закрытия
шлагбаума, доступ к логу и т.п.
</p>
</div>
</div>

<div id="outline-container-sec-8-8" class="outline-3">
<h3 id="sec-8-8"><span class="section-number-3">8.8</span> Модуль <code>бухгалтера</code></h3>
<div class="outline-text-3" id="text-8-8">
<p>
Добавляет в систему возможность получения финансовых отчётов по парковке и кассовым
аппаратам (нарастающий итог, оборот по кассам и т.п.), а также делает возможным
автоматическое снятие Z-отчётов, печать копий Z-отчётов, изъятие установленной суммы
из автоматической кассы и т.д.
</p>
</div>
</div>

<div id="outline-container-sec-8-9" class="outline-3">
<h3 id="sec-8-9"><span class="section-number-3">8.9</span> Модуль <code>фотофиксации</code></h3>
<div class="outline-text-3" id="text-8-9">
<p>
Добавляет в систему фотографирования камерами по событию. В интерфейсе
администратора системы добавляется функция привязки камеры к конкретной стойке и
список событий, производимых со стойкой, по которым камера должна производить
фотографирование. Во все логи, в том числе и у оператора парковки, к сообщениям о
данных событиях прикрепляются фотографии. Также добавляются интерфейсы машины на
парковке и аудиторфотофиксации в которых можно посмотреть фотографии всех машин,
которые приехали на парковку и находятся на ней и, соответственно, приехали и уехали
с парковки в установленный промежуток времени.
</p>
</div>
</div>

<div id="outline-container-sec-8-10" class="outline-3">
<h3 id="sec-8-10"><span class="section-number-3">8.10</span> Модуль <code>распознания номеров</code></h3>
<div class="outline-text-3" id="text-8-10">
<p>
Интеграция с SIP сервером VoIP связи Asterisk
</p>
</div>
</div>

<div id="outline-container-sec-8-11" class="outline-3">
<h3 id="sec-8-11"><span class="section-number-3">8.11</span> Модуль <code>дуплексной IP связи</code></h3>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> План работ</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> <span class="todo START">START</span> Составление исполняемой спецификации, внесение описаний работы и кейсов</h3>
<div class="outline-text-3" id="text-9-1">
</div><div id="outline-container-sec-9-1-1" class="outline-4">
<h4 id="sec-9-1-1"><span class="section-number-4">9.1.1</span> <span class="todo START">START</span> Описать <code>happy-cases</code></h4>
<div class="outline-text-4" id="text-9-1-1">
</div><ol class="org-ol"><li><a id="sec-9-1-1-1"></a><span class="done DONE">DONE</span> На алгоритмы проезда<br  /></li>
<li><a id="sec-9-1-1-2"></a><span class="todo TODO">TODO</span> На алгоритмы оплаты<br  /></li>
<li><a id="sec-9-1-1-3"></a><span class="todo TODO">TODO</span> Совмещенные алгоритмы<br  /></li></ol>
</div>
<div id="outline-container-sec-9-1-2" class="outline-4">
<h4 id="sec-9-1-2"><span class="section-number-4">9.1.2</span> <span class="todo TODO">TODO</span> Описать полный цикл работы системы с обработкой ошибок</h4>
<div class="outline-text-4" id="text-9-1-2">
</div><ol class="org-ol"><li><a id="sec-9-1-2-1"></a>На алгоритмы проезда<br  /></li>
<li><a id="sec-9-1-2-2"></a>На алгоритмы оплаты<br  /></li>
<li><a id="sec-9-1-2-3"></a>Совмещенные алгоритмы<br  /></li></ol>
</div>

<div id="outline-container-sec-9-1-3" class="outline-4">
<h4 id="sec-9-1-3"><span class="section-number-4">9.1.3</span> <span class="todo TODO">TODO</span> Составить список событий в системе и конечный автомат</h4>
</div>
</div>
<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> <span class="todo TODO">TODO</span> Выделение состояний системы</h3>
</div>
<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> Описание конечно-автоматной работы системы и ее ручная верификация</h3>
</div>
<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> Декларативное описание конечных автоматов</h3>
</div>
<div id="outline-container-sec-9-5" class="outline-3">
<h3 id="sec-9-5"><span class="section-number-3">9.5</span> Написание генератора кода модели системы</h3>
</div>
<div id="outline-container-sec-9-6" class="outline-3">
<h3 id="sec-9-6"><span class="section-number-3">9.6</span> Верификация работы системы на модели</h3>
</div>
<div id="outline-container-sec-9-7" class="outline-3">
<h3 id="sec-9-7"><span class="section-number-3">9.7</span> Расширение модели рабочим кодом</h3>
</div>
<div id="outline-container-sec-9-8" class="outline-3">
<h3 id="sec-9-8"><span class="section-number-3">9.8</span> Макетирование прототипа</h3>
</div>
<div id="outline-container-sec-9-9" class="outline-3">
<h3 id="sec-9-9"><span class="section-number-3">9.9</span> Проверка элементов системы на макете прототипа</h3>
</div>
<div id="outline-container-sec-9-10" class="outline-3">
<h3 id="sec-9-10"><span class="section-number-3">9.10</span> Тестирование рабочего кода на прототипе устройства</h3>
</div>
<div id="outline-container-sec-9-11" class="outline-3">
<h3 id="sec-9-11"><span class="section-number-3">9.11</span> Отладка и интеграционное тестирование</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: rigidus</p>
<p class="date">Created: 2015-11-24 Вт. 21:29</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode )</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
